{"ast":null,"code":"import * as pdfjsLib from 'pdfjs-dist';\n\n// Set up the worker for pdf.js\npdfjsLib.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;\nexport async function findRegionField(pdfUrl) {\n  const loadingTask = pdfjsLib.getDocument({\n    url: pdfUrl,\n    cMapUrl: \"https://unpkg.com/pdfjs-dist@latest/cmaps/\",\n    cMapPacked: true\n  });\n  const pdf = await loadingTask.promise;\n  console.log(\"PDF loaded successfully\");\n  for (let i = 1; i <= pdf.numPages; i++) {\n    const page = await pdf.getPage(i);\n    const textContent = await page.getTextContent();\n    const annotations = await page.getAnnotations();\n\n    // Find the \"Region\" label\n    let regionLabel = null;\n    for (const item of textContent.items) {\n      if (item.str.trim() === \"Region\") {\n        const [,,,, x, y] = item.transform;\n        regionLabel = {\n          x,\n          y\n        };\n        break;\n      }\n    }\n    if (regionLabel) {\n      // Find the nearest input field below the \"Region\" label\n      let nearestField = null;\n      let minDistance = Infinity;\n      for (const annotation of annotations) {\n        const [x1, y1, x2, y2] = annotation.rect;\n        const fieldY = (y1 + y2) / 2;\n        const fieldX = (x1 + x2) / 2;\n\n        // Check if the field is below the label and within horizontal range\n        if (fieldY < regionLabel.y && Math.abs(fieldX - regionLabel.x) < 100) {\n          const distance = regionLabel.y - fieldY;\n          if (distance < minDistance) {\n            minDistance = distance;\n            nearestField = {\n              label: \"Region\",\n              inputField: {\n                fieldName: annotation.fieldName || \"Unnamed Field\",\n                inputType: annotation.fieldType || \"Unknown\",\n                value: annotation.fieldValue || \"\",\n                options: annotation.options ? annotation.options.map(opt => opt.displayValue || opt.value) : []\n              }\n            };\n          }\n        }\n      }\n      if (nearestField) {\n        return nearestField;\n      }\n    }\n  }\n  return null;\n}","map":{"version":3,"names":["pdfjsLib","GlobalWorkerOptions","workerSrc","version","findRegionField","pdfUrl","loadingTask","getDocument","url","cMapUrl","cMapPacked","pdf","promise","console","log","i","numPages","page","getPage","textContent","getTextContent","annotations","getAnnotations","regionLabel","item","items","str","trim","x","y","transform","nearestField","minDistance","Infinity","annotation","x1","y1","x2","y2","rect","fieldY","fieldX","Math","abs","distance","label","inputField","fieldName","inputType","fieldType","value","fieldValue","options","map","opt","displayValue"],"sources":["C:/Users/Vidu/OneDrive/Desktop/Xenon Innovation/Expenser/client/src/components/FillForm/PdfToJson.js"],"sourcesContent":["import * as pdfjsLib from 'pdfjs-dist';\r\n\r\n// Set up the worker for pdf.js\r\npdfjsLib.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjsLib.version}/pdf.worker.min.js`;\r\n\r\nexport async function findRegionField(pdfUrl) {\r\n    const loadingTask = pdfjsLib.getDocument({\r\n        url: pdfUrl,\r\n        cMapUrl: \"https://unpkg.com/pdfjs-dist@latest/cmaps/\",\r\n        cMapPacked: true,\r\n    });\r\n\r\n    const pdf = await loadingTask.promise;\r\n    console.log(\"PDF loaded successfully\");\r\n\r\n    for (let i = 1; i <= pdf.numPages; i++) {\r\n        const page = await pdf.getPage(i);\r\n        const textContent = await page.getTextContent();\r\n        const annotations = await page.getAnnotations();\r\n\r\n        // Find the \"Region\" label\r\n        let regionLabel = null;\r\n        for (const item of textContent.items) {\r\n            if (item.str.trim() === \"Region\") {\r\n                const [, , , , x, y] = item.transform;\r\n                regionLabel = { x, y };\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (regionLabel) {\r\n            // Find the nearest input field below the \"Region\" label\r\n            let nearestField = null;\r\n            let minDistance = Infinity;\r\n\r\n            for (const annotation of annotations) {\r\n                const [x1, y1, x2, y2] = annotation.rect;\r\n                const fieldY = (y1 + y2) / 2;\r\n                const fieldX = (x1 + x2) / 2;\r\n\r\n                // Check if the field is below the label and within horizontal range\r\n                if (fieldY < regionLabel.y && Math.abs(fieldX - regionLabel.x) < 100) {\r\n                    const distance = regionLabel.y - fieldY;\r\n                    if (distance < minDistance) {\r\n                        minDistance = distance;\r\n                        nearestField = {\r\n                            label: \"Region\",\r\n                            inputField: {\r\n                                fieldName: annotation.fieldName || \"Unnamed Field\",\r\n                                inputType: annotation.fieldType || \"Unknown\",\r\n                                value: annotation.fieldValue || \"\",\r\n                                options: annotation.options ? annotation.options.map(opt => opt.displayValue || opt.value) : []\r\n                            }\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (nearestField) {\r\n                return nearestField;\r\n            }\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n"],"mappings":"AAAA,OAAO,KAAKA,QAAQ,MAAM,YAAY;;AAEtC;AACAA,QAAQ,CAACC,mBAAmB,CAACC,SAAS,GAAG,2CAA2CF,QAAQ,CAACG,OAAO,oBAAoB;AAExH,OAAO,eAAeC,eAAeA,CAACC,MAAM,EAAE;EAC1C,MAAMC,WAAW,GAAGN,QAAQ,CAACO,WAAW,CAAC;IACrCC,GAAG,EAAEH,MAAM;IACXI,OAAO,EAAE,4CAA4C;IACrDC,UAAU,EAAE;EAChB,CAAC,CAAC;EAEF,MAAMC,GAAG,GAAG,MAAML,WAAW,CAACM,OAAO;EACrCC,OAAO,CAACC,GAAG,CAAC,yBAAyB,CAAC;EAEtC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAIJ,GAAG,CAACK,QAAQ,EAAED,CAAC,EAAE,EAAE;IACpC,MAAME,IAAI,GAAG,MAAMN,GAAG,CAACO,OAAO,CAACH,CAAC,CAAC;IACjC,MAAMI,WAAW,GAAG,MAAMF,IAAI,CAACG,cAAc,CAAC,CAAC;IAC/C,MAAMC,WAAW,GAAG,MAAMJ,IAAI,CAACK,cAAc,CAAC,CAAC;;IAE/C;IACA,IAAIC,WAAW,GAAG,IAAI;IACtB,KAAK,MAAMC,IAAI,IAAIL,WAAW,CAACM,KAAK,EAAE;MAClC,IAAID,IAAI,CAACE,GAAG,CAACC,IAAI,CAAC,CAAC,KAAK,QAAQ,EAAE;QAC9B,MAAM,MAASC,CAAC,EAAEC,CAAC,CAAC,GAAGL,IAAI,CAACM,SAAS;QACrCP,WAAW,GAAG;UAAEK,CAAC;UAAEC;QAAE,CAAC;QACtB;MACJ;IACJ;IAEA,IAAIN,WAAW,EAAE;MACb;MACA,IAAIQ,YAAY,GAAG,IAAI;MACvB,IAAIC,WAAW,GAAGC,QAAQ;MAE1B,KAAK,MAAMC,UAAU,IAAIb,WAAW,EAAE;QAClC,MAAM,CAACc,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC,GAAGJ,UAAU,CAACK,IAAI;QACxC,MAAMC,MAAM,GAAG,CAACJ,EAAE,GAAGE,EAAE,IAAI,CAAC;QAC5B,MAAMG,MAAM,GAAG,CAACN,EAAE,GAAGE,EAAE,IAAI,CAAC;;QAE5B;QACA,IAAIG,MAAM,GAAGjB,WAAW,CAACM,CAAC,IAAIa,IAAI,CAACC,GAAG,CAACF,MAAM,GAAGlB,WAAW,CAACK,CAAC,CAAC,GAAG,GAAG,EAAE;UAClE,MAAMgB,QAAQ,GAAGrB,WAAW,CAACM,CAAC,GAAGW,MAAM;UACvC,IAAII,QAAQ,GAAGZ,WAAW,EAAE;YACxBA,WAAW,GAAGY,QAAQ;YACtBb,YAAY,GAAG;cACXc,KAAK,EAAE,QAAQ;cACfC,UAAU,EAAE;gBACRC,SAAS,EAAEb,UAAU,CAACa,SAAS,IAAI,eAAe;gBAClDC,SAAS,EAAEd,UAAU,CAACe,SAAS,IAAI,SAAS;gBAC5CC,KAAK,EAAEhB,UAAU,CAACiB,UAAU,IAAI,EAAE;gBAClCC,OAAO,EAAElB,UAAU,CAACkB,OAAO,GAAGlB,UAAU,CAACkB,OAAO,CAACC,GAAG,CAACC,GAAG,IAAIA,GAAG,CAACC,YAAY,IAAID,GAAG,CAACJ,KAAK,CAAC,GAAG;cACjG;YACJ,CAAC;UACL;QACJ;MACJ;MAEA,IAAInB,YAAY,EAAE;QACd,OAAOA,YAAY;MACvB;IACJ;EACJ;EAEA,OAAO,IAAI;AACf","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}